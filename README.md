**Проект DAVrun** - Это комплекс программ для автоматической и безопасной развёртки самораспаковывающихся архивов на большое количество компьютеров не связанных одной сетью.

_Проект полностью открыт и распространяется по лицензии MIT._

**Проект DAVrun** позволяет обслуживать большое количество компьютеров, которые никак не связаны между собой и могут находиться в любых городах или странах без открытия каких либо портов на компьютерах (открывается только один порт на сервере для приёма соединений). Программа в автоматическом режиме скачивает и запускает самораспаковывающиеся архивы с административными правами, а тут уже можно разгуляться, на сколько хватит фантазии и опыта создания скриптов для автоматизации через самораспаковывающиеся архивы.

Мой проект, использует технологию WebDAV, работающий на зашифрованном HTTPS соединении, а подключение к серверу и обмен данными происходит с помощью библиотеки “libcurl”, с дополнительными защитами.

---

**Это не полностью готовый к использованию проект из коробки, нужно немного поработать ручками, что бы его собрать, но проблем не должно быть, так как постарался сделать максимально подробные инструкции для каждой части проекта с файлами (README #1, README #2 и т.д.), которые находятся в каждой папке к проекту, нужно просто по очереди следовать инструкциям.**

В первую очередь делал проект для себя и ради хобби, а так же для рабочих целей на практике.

Проект старался сделать более универсальным, что бы другой человек (сисадмин) без особых знаний в программировании мог собрать проект и использовать для своих нужд.

---

**Очень кратко, что делать и как это работает.**

*   Поднимается сервер на Линуксе, на котором запускается уже готовый скрипт для настройки серверной части.
*   Далее скачиваются программы для компиляции кода на языках “C” и “C#” и компилируем исполняемые файлы.
*   Создаём установочный файл для программы “DAVrun” и службы с некоторыми библиотеками, что бы удобно было ставить на большое кол-во компьютеров (тихая установка поддерживается).
*   В программе “Admin DAVrun” выбираем уже заранее подготовленный самораспаковывающийся архив с нужными нам действиями, выбираем на какие компьютеры установить (файлы с именами компьютеров тоже нужно подготовить) этот архив и ждём.
*   Раз в 10 минут служба на клиентском компьютере будет запускать программу “DAVrun”, и есть указанный компьютер в списке на установку, тогда скачивает самораспаковывающийся архив и запускает его с наивысшими правами на выполнение.

---

**Порядок сборки проекта.**

1.  Скачиваем архив со всем проектом и распаковываем.
2.  В папке “**1\. Скрипт сервера WebDAV**” и внимательно читаем “**README #1.txt**”.
3.  Далее переходим в папку “**2\. DAVrun**” и внимательно читаем “**README #2.txt**”.
4.  Переходим в папку “**3\. SERVICE-DAVrun**” и внимательно читаем “**README #3.txt**”.
5.  Переходим в папку “**4\. Создание установочного файла**” и внимательно читаем “**README #4.txt**”.
6.  И в папке “**5\. Admin DAVrun**” внимательно читаем “**README #5.txt**”.

---

**Так же для данного проекта рекомендую утилиты.**

> **SwitchRegPowerShell**:
> 
> GitHub страница:  [https://github.com/Otto17/SwitchRegPowerShell](https://github.com/Otto17/SwitchRegPowerShell)  
> GitFlic страница:   [https://gitflic.ru/project/otto/switchregpowershell](https://gitflic.ru/project/otto/switchregpowershell)

> **CertificateInstaller:**
> 
> GitHub страница:  [https://github.com/Otto17/CertificateInstaller](https://github.com/Otto17/CertificateInstaller)  
> GitFlic страница:   [https://gitflic.ru/project/otto/certificateinstaller](https://gitflic.ru/project/otto/certificateinstaller)

> **DelCert:**
> 
> GitHub страница:  [https://github.com/Otto17/DelCert](https://github.com/Otto17/DelCert)  
> GitFlic страница:   [https://gitflic.ru/project/otto/delcert](https://gitflic.ru/project/otto/delcert)

> **DelApplication:**
> 
> GitHub страница:  [https://github.com/Otto17/DelApplication](https://github.com/Otto17/DelApplication)  
> GitFlic страница:   [https://gitflic.ru/project/otto/delapplication](https://gitflic.ru/project/otto/delapplication)

---

### Версии

**30.06.2024г.**

*   Добавил в "Скрипт сервера WebDAV" очистку локального кэша скаченных и уже установленных пакетов.
*   Добавил в программу "Client DAVrun" автообновление списка с именами компьютеров ожидающими установку.
*   В программе "Client DAVrun" изменил недочёт связанный с именем при загрузке самораспаковывающегося setup файла на сервер, теперь можно выбирать архивы с любым именем и символами, на сервер всегда будет загружаться автоматически такое имя "setup.exe\_хеш".
*   Добавил в папку "Создание установочного файла" bat файл "Silent\_Install.bat" для тихой установки.

**04.07.2024г.**

*   Изменил в программе "DAVrun" принцип поиска файлов на сервере, теперь поиск осуществляется через библиотеку "libxml2", что даёт возможность корректно обрабатывать файлы по маске и с поддержкой Кириллицы.
*   Теперь можно указать не только строго имя компьютера "NoteBook\_Otto", а так же через знак "=", до которого любой текст будет игнорироваться, это даёт возможность понятным языком написать, что это за компьютер.
    
    Можно писать как "г. Омск, ул. Буржуйская,17\_7 \*Мой(ДОМ)\*=NoteBook\_Otto" или "NoteBook\_Otto" - оба варианта будут корректно обрабатываться (тестировал с 5000 фалов, время поиска составило около 1 секунды +/-).
    
*   Добавил регистронезависимость в программе "DAVrun" для поиска файлов на сервере с помощью библиотеки "libicu". Верхний и нижний регистры "NoTebOok\_OTTo" теперь будут корректно обрабатываться (тестировал на наборе символов: г. .\_-{}()\[\]!@#$%^&+;~,\`' Гуся, Тест711 % 2A-\_ ;%23+!@(&) ТЕСТ=NoTebOok\_OTTo).
*   В скрипт "Создание установочного файла" добавил автоматическую установку (онлайн) "Visual C++ 2015-2022 Redistributable", в случае, если данные библиотеки не установлены в системе.
*   Так же упросил процесс создания установочного файла, теперь не нужно ничего копировать в корень диска, просто кидаете в папку "build" файлы по инструкции, запускаете скрипт “Script\_Setup\_DAVrun.iss” и компилируете (обновил Inno Setup до версии v6.3.2).
*   Переименовал проект "Client DAVrun" в "Admin DAVrun", так логичнее, так как утилита для сисадминов, а не пользователей и немного подправил текст уведомлений.
*   В окне “Процесс установки” в "Admin DAVrun" изменил вывод, что бы выводился список с полным именем файла, а не только именем компьютера после знака равно, так как уже научил “DAVrun” корректно обрабатывать такие имена файлов.

**07.07.2024г.**

*    Исправил в "Admin DAVrun" дёрганую строку с отображением прогресса загрузки setup файла.

**11.07.2024г.**

*   Добавил в корень проекта папку "Генераторы ключей", в которую переместил "Keygen bytes AES-256 - key\_IV" и добавил ещё генератор "Keygen Pepper Hard Passwd" для создания рандомного ключа и соли для программы "DAVrun".

**13.07.2024г.**

*   Изменил программу "DAVrun", теперь она может принимать настройки хоста, логина, пароля, имени сертификата, названия папки на сервере для поиска файлов и кол-во обрезаемых символов имени компьютера от начала (от 0 до 14 символов) и сохранять это в зашифрованный конфиг файл в этой же папке.  
    Скомпилировать программу можно как с привязкой к компьютеру, это даёт очень высокий уровень защиты конфига, так как ключ шифрования будет храниться в защищённом хранилище Windows, но конфиг будет НЕ переносим на другие ПК.  
    Второй вариант - это скомпилировать программу без привязки к компьютеру, конфиг будет переносим на другие компьютеры, зашифрованный ключ будет храниться рядом с зашифрованным конфигом, но это уменьшает безопасность, тем не менее расшифровать конфиг и узнать логин/пароль будет очень сложно. В этом случае перед компиляцией нужно обязательно сгенерировать жёстко задаваемый пароль и "перец" через генератор "Keygen Pepper Hard Passwd" из папки "Генераторы ключей".  
    Любой из двух вариантов можно выбрать перед компиляцией "DAVrun" в исходном коде.  
    Вызвать справку по программе можно запустив в командной строке "DAVrun.exe" без аргументов до создания конфиг файла.  
    Вот так это выглядит:  
    Использование: DAVrun.exe "Хост" "Логин" "Пароль" "Имя сертификата с расширением" "Каталог ожидания установок на сервере" "Кол-во символов (число от 0 до 14) для обрезки символов от начала имени ПК"  
    Пример: DAVrun.exe "https://77.77.77.77:7777/webdaw/" "User" "Password" "cert.crt" "Points" 7
*   Разбил исходный код программы "DAVrun" на отдельные файлы, так как проект стал уже не маленький и в одном файле заниматься отладкой становиться сложнее.
*   Немного улучшил информативность вывода от библиотеки libcurl в лог файл для программы "DAVrun".
*   Добавил в скрипт "Создание установочного файла" возможность указать данные сервера и включить автоматическое создание зашифрованного конфиг файла, так же исправил ошибку с отображением иконки в “Установка и удаление программ”.

---

**Автор Otto, г. Омск 2024**
