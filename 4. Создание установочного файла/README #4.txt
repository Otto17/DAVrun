Данный скрипт для Inno Setup является свободным программным обеспечением, распространяющимся по лицензии MIT.
Копия лицензии: https://opensource.org/licenses/MIT
Копия лицензии Inno Setup: https://jrsoftware.org/files/is/license.txt


Copyright (c) 2024 Otto
Автор: Otto
Версия: 04.07.24
GitHub страница:  https://github.com/Otto17/DAVrun
GitFlic страница: https://gitflic.ru/project/otto/davrun

г. Омск 2024


Скрипт создания установочного файла (для быстрого и удобного развёртывания на большом количестве ПК).

Порядок создания установочного файла:
1) Устанавливаем Inno Setup из папки "Стороннее ПО" или скачать с официального сайта "https://jrsoftware.org/";
2) Копируем в папку "build\DAVrun" скомпилированный ранее файл "DAVrun.exe" (со своим логином и паролем);
3) Скачиваем сертификат открытого ключа через браузеры. Для этого открываем страницу WebDAV в браузере (можно даже не авторизоваться).

В Google Chrome/Chromium/Хром ГОСТ и аналогичных ему: в адресной строке жмём на красную кнопку "Не защищено" -> Недействительный сертификат -> Подробнее -> экспорт... и сохраняем под именем "cert.crt" (имя НЕ менять).

В Mozilla Firefox экспорт происходит с расширением "*.pem", разницы нет, что использовать, но для того, что бы программа в "DAVrun" проходила проверка сертификата, нужно компилировать "DAVrun" с изменённым расширением в директиве "#define CURL_CRT" (по умолчанию стоит *.crt).
В Firefox выйдет надпись "Предупреждение: Вероятная угроза безопасности", ниже жмём Дополнительно... -> Посмотреть сертификат, прокручиваем ниже и жмём "Загрузить PEM (сертификат)", он скачается без запроса установки имени, переименовываем его в "cert.pem" или "cert.crt", В ДАННОМ СЛУЧАЕ без разницы, так как они оба являются текстовыми форматами в Base64, хотя *.pem может быть и в бинарном формате (но не в нашем случае).

Можно так же вместо использования браузеров скопировать вручную с сервера сертификат открытого ключа, он находится по пути "/etc/ssl/certs/{USER_SYSTEM}.crt" и обязательно переименовать его в "cert.crt" или "cert.pem" (смотря что выбрано при компиляции "DAVrun").

4) Открываем скрипт "Script_Setup_DAVrun.iss" в Inno Setup и жмём Ctrl+F9 или Build -> Compile;
5) Рядом со скриптом создастся установочный файл "Setup_DAVrun.exe".


P.S. Для тихой установки использовать ключ "/verysilent", получится так "Setup_DAVrun.exe /verysilent" или использовать "Silent_Install.bat".

На Windows 8/8.1 запускать обязательно от имени администратора, иначе исключение в антивирус (Защитник Windows) может не добавиться и служба может не запуститься, на Windows 10/11 такой проблемы не заметил. На Windows 7 не проверял.
Так же Windows 8/8.1 при удалении программы с компьютера не удаляется исключение из антивируса.

Исключения нужны обязательно для папки "C:\ProgramData\DAVrun", иначе антивирусы могут ложно ругаться на самораспаковывающиеся архивы после загрузки из с сервера.
